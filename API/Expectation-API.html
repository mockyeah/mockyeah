
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>.expect() Â· mockyeah</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Ryan Ricard">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Expectation-API.html" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../Getting-Started.html">
            
                <a href="../Getting-Started.html">
            
                    
                    Getting Started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../Getting-Started.html">
            
                <a href="../Getting-Started.html#install">
            
                    
                    Install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../Getting-Started.html">
            
                <a href="../Getting-Started.html#introductory-tutorial">
            
                    
                    Introductory tutorial
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../Getting-Started.html">
            
                <a href="../Getting-Started.html#testing-with-mockyeah">
            
                    
                    Testing with mockyeah
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../Configuration.html">
            
                <a href="../Configuration.html">
            
                    
                    Configuration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../Configuration.html">
            
                <a href="../Configuration.html#default-configuration">
            
                    
                    Defaults
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../Configuration.html">
            
                <a href="../Configuration.html#options">
            
                    
                    Options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../Configuration.html">
            
                <a href="../Configuration.html#https">
            
                    
                    HTTPS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    API
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" >
            
                <span>
            
                    
                    Mock API
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="Mock-API.html">
            
                <a href="Mock-API.html">
            
                    
                    get/post/put/patch/delete/all()
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1.1" data-path="Mock-API.html">
            
                <a href="Mock-API.html#match">
            
                    
                    Request Match
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.1.2" data-path="Mock-API.html">
            
                <a href="Mock-API.html#options">
            
                    
                    Response Options
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="close.html">
            
                <a href="close.html">
            
                    
                    close()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="play.html">
            
                <a href="play.html">
            
                    
                    play()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.4" data-path="playAll.html">
            
                <a href="playAll.html">
            
                    
                    playAll()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.5" data-path="proxy.html">
            
                <a href="proxy.html">
            
                    
                    proxy()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.6" data-path="record.html">
            
                <a href="record.html">
            
                    
                    record()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.7" data-path="recordStop.html">
            
                <a href="recordStop.html">
            
                    
                    recordStop()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.8" data-path="reset.html">
            
                <a href="reset.html">
            
                    
                    reset()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.9" data-path="shutdown.md">
            
                <span>
            
                    
                    shutdown()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.10" data-path="start.html">
            
                <a href="start.html">
            
                    
                    start()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.11" data-path="startedPromise.html">
            
                <a href="startedPromise.html">
            
                    
                    startedPromise
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.12" data-path="unwatch.html">
            
                <a href="unwatch.html">
            
                    
                    unwatch()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.13" data-path="watch.html">
            
                <a href="watch.html">
            
                    
                    watch()
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" >
            
                <span>
            
                    
                    Expectation API
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#expect">
            
                    
                    .expect()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#structural">
            
                    
                    Quantitative
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#atLeast">
            
                    
                    .expect().atLeast()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#atMost">
            
                    
                    .expect().atMost()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.5" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#never">
            
                    
                    .expect().never()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.6" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#once">
            
                    
                    .expect().once()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.7" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#twice">
            
                    
                    .expect().twice()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.8" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#thrice">
            
                    
                    .expect().thrice()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.9" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#exactly">
            
                    
                    .expect().exactly()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.10" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#structural">
            
                    
                    Structural
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.11" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#path">
            
                    
                    .expect().path()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.12" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#url">
            
                    
                    .expect().url()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.13" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#body">
            
                    
                    .expect().body()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.14" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#params">
            
                    
                    .expect().params()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.15" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#header">
            
                    
                    .expect().header()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.16" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#execute">
            
                    
                    Execute
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.17" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#run">
            
                    
                    .expect().run()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.18" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#verify">
            
                    
                    .expect().verify()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.19" data-path="Expectation-API.html">
            
                <a href="Expectation-API.html#verifier">
            
                    
                    .expect().verifier()
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="Match-Values.html">
            
                <a href="Match-Values.html">
            
                    
                    Match Values
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" >
            
                <span>
            
                    
                    Classes
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.4.1" data-path="Server.html">
            
                <a href="Server.html">
            
                    
                    Server
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../Suites/Overview.html">
            
                <a href="../Suites/Overview.html">
            
                    
                    Suites
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../Suites/Overview.html">
            
                <a href="../Suites/Overview.html#suites-overview">
            
                    
                    Suites Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../Suites/Overview.html">
            
                <a href="../Suites/Overview.html#ad-hoc-suites">
            
                    
                    Ad Hoc Suites
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../CLI/CLI.html">
            
                <a href="../CLI/CLI.html">
            
                    
                    CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../Testing.html">
            
                <a href="../Testing.html">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <a target="_blank" href="https://github.com/mockyeah/mockyeah/tree/master/examples">
            
                    
                    Recipes & Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../Contributing.html">
            
                <a href="../Contributing.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >.expect()</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="mock-expectations">Mock Expectations</h1>
<p>The Expectation API enables you to verify your integration via the perspective of mockyeah. Chaining <code>.expect()</code> with any number of supported expectation functions returns an expectation object that can be verified at the end of your test. There are <a href="#quantitative">quantitative</a>, <a href="#structural">structural</a>,
and other expectation functions.</p>
<p>Example:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> mockyeah = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;mockyeah&apos;</span>);
<span class="hljs-keyword">const</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;supertest&apos;</span>);

describe(<span class="hljs-string">&apos;This test&apos;</span>, () =&gt; {
  it(<span class="hljs-string">&apos;should verify service is called once with parameter&apos;</span>, () =&gt;
    mockyeah
      .expect({
        method: <span class="hljs-string">&apos;get&apos;</span>,
        path: <span class="hljs-string">&apos;/say-hello&apos;</span>,
        query: {
          foo: <span class="hljs-string">&apos;bar&apos;</span>
        }
      })
      .once()
      .run(() =&gt; request(<span class="hljs-string">&apos;http://localhost:4001&apos;</span>).get(<span class="hljs-string">&apos;/say-hello?foo=bar&apos;</span>))
      .verify());
});
</code></pre>
<p>If you would prefer to use the <a href="Mock-API.html">Mock API</a> methods to setup endpoints:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> mockyeah = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;mockyeah&apos;</span>);
<span class="hljs-keyword">const</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;supertest&apos;</span>);

describe(<span class="hljs-string">&apos;This test&apos;</span>, () =&gt; {
  it(<span class="hljs-string">&apos;should verify service is called once with parameter&apos;</span>, () =&gt;
    mockyeah
      .get(<span class="hljs-string">&apos;/say-hello&apos;</span>, { text: <span class="hljs-string">&apos;hello&apos;</span> })
      .expect()
      .params({
        foo: <span class="hljs-string">&apos;bar&apos;</span>
      })
      .once()
      .run(() =&gt; request(<span class="hljs-string">&apos;http://localhost:4040&apos;</span>).get(<span class="hljs-string">&apos;/say-hello?foo=bar&apos;</span>))
      .verify());
});
</code></pre>
<p>Or without <code>run</code>, with <code>verifier</code> call as callback:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> mockyeah = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;mockyeah&apos;</span>);
<span class="hljs-keyword">const</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;supertest&apos;</span>);

describe(<span class="hljs-string">&apos;This test&apos;</span>, () =&gt; {
  it(<span class="hljs-string">&apos;should verify service is called once with parameter&apos;</span>, done =&gt; {
    <span class="hljs-keyword">const</span> expectation = mockyeah
      .get(<span class="hljs-string">&apos;/say-hello&apos;</span>, { text: <span class="hljs-string">&apos;hello&apos;</span> })
      .expect()
      .params({
        foo: <span class="hljs-string">&apos;bar&apos;</span>
      })
      .once();

    request(<span class="hljs-string">&apos;http://localhost:4040&apos;</span>)
      .get(<span class="hljs-string">&apos;/say-hello?foo=bar&apos;</span>)
      .expect(<span class="hljs-number">200</span>, expectation.verifier(done));
  });
});
</code></pre>
<p>Or with <code>verify</code> instead of <code>verifier</code> (be sure handle prior errors and try/catch the call, which <code>verifier</code> does for you):</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> mockyeah = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;mockyeah&apos;</span>);
<span class="hljs-keyword">const</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;supertest&apos;</span>);

describe(<span class="hljs-string">&apos;This test&apos;</span>, () =&gt; {
  it(<span class="hljs-string">&apos;should verify service is called once with parameter&apos;</span>, done =&gt; {
    <span class="hljs-keyword">const</span> expectation = mockyeah
      .get(<span class="hljs-string">&apos;/say-hello&apos;</span>, { text: <span class="hljs-string">&apos;hello&apos;</span> })
      .expect()
      .params({
        foo: <span class="hljs-string">&apos;bar&apos;</span>
      })
      .once();

    request(<span class="hljs-string">&apos;http://localhost:4040&apos;</span>)
      .get(<span class="hljs-string">&apos;/say-hello?foo=bar&apos;</span>)
      .expect(<span class="hljs-number">200</span>, err =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          done(err);
          <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">try</span> {
          expectation.verify(done);
        } <span class="hljs-keyword">catch</span> (err2) {
          done(err2);
        }
      });
  });
});
</code></pre>
<h2 id="expectations">Expectations</h2>
<div id="expect"></div>

<p><code>.expect(optionalPredicateOrMatchObject)</code> -
Returns an expectation object for a given mock service when chained
to a <a href="Mock-API.html">Mock API</a> method call.</p>
<p>It optionally accepts a <a href="Match-Values.html">match value</a>, in this case either
an object or a function, allowing you to assert on several fields of the request at once,
as an alternative to the individual functions below like <code>query()</code>, <code>body()</code>, etc.
The match will be against an object with the following fields:</p>
<ul>
<li><code>method</code> (String): the request method (lowercase).</li>
<li><code>path</code> (String): the request path.</li>
<li><code>query</code> (Object): a key/value map of query parameters.</li>
<li><code>headers</code> (Object): a key/value map of headers. Header names are all lowercase.</li>
<li><code>body</code> (Object|String): the parsed response body. If JSON, then an object, otherwise a string.</li>
<li><code>req</code> (Object): the raw Express request object for additional custom assertions.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { expect } = reuqire(<span class="hljs-string">&apos;chai&apos;</span>);

<span class="hljs-keyword">const</span> expectation = mockyeah
  .post(<span class="hljs-string">&apos;/foo&apos;</span>, {
    text: <span class="hljs-string">&apos;bar&apos;</span>
  })
  .expect(data =&gt; {
    expect(data.method).to.equal(<span class="hljs-string">&apos;post&apos;</span>);
    expect(data.path).to.equal(<span class="hljs-string">&apos;/foo&apos;</span>);
    expect(data.query.id).to.equal(<span class="hljs-string">&apos;9999&apos;</span>);
    expect(data.headers.host).to.equal(<span class="hljs-string">&apos;example.com&apos;</span>);
    expect(data.body.foo).to.equal(<span class="hljs-string">&apos;bar&apos;</span>);
    expect(data.req.originalUrl).to.equal(<span class="hljs-string">&apos;/foo?id=9999&apos;</span>);
  });
</code></pre>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> expectation = mockyeah
  .post(<span class="hljs-string">&apos;/foo&apos;</span>, {
    text: <span class="hljs-string">&apos;bar&apos;</span>
  })
  .expect({
    method: <span class="hljs-string">&apos;post&apos;</span>,
    path: <span class="hljs-string">&apos;/foo&apos;</span>,
    query: {
      id: <span class="hljs-regexp">/99/</span>,
      int: <span class="hljs-number">3</span>
    },
    headers: value =&gt; value.host.includes(<span class="hljs-string">&apos;example&apos;</span>),
    body: {
      foo: <span class="hljs-string">&apos;bar&apos;</span>
    }
  });
</code></pre>
<h2 id="quantitative">Quantitative</h2>
<div id="atLeast">

`.atLeast(Number)` - Adds expectation that a service must be called at least a specified number of times.

<div id="atMost"></div>

<p><code>.atMost(Number)</code> - Adds expectation that a service must be called at most a specified number of times.</p>
<div id="never"></div>

<p><code>.never()</code> - Adds expectation that a service must never be called.</p>
<div id="once"></div>

<p><code>.once()</code> - Adds expectation that a service must be called only once.</p>
<div id="twice"></div>

<p><code>.twice()</code> - Adds expectation that a service must be called only twice.</p>
<div id="thrice"></div>

<p><code>.thrice()</code> - Adds expectation that a service must be called only thrice.</p>
<div id="exactly"></div>

<p><code>.exactly(Number)</code> - Adds expectation that a service must be called exactly a specified number of times.</p>
<h2 id="structural">Structural</h2>
<div id="path"></div>

<p><code>.path(MatchValue)</code> - Adds an expectation that a service must receive only requests with paths matching the value specified. See <a href="Match-Values.html">match value</a>.</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> expectation = mockyeah
  .get(<span class="hljs-string">&apos;*&apos;</span>)
  .expect()
  .path(<span class="hljs-string">&apos;/foo&apos;</span>);
</code></pre>
<div id="url"></div>

<p><code>.url(MatchValue)</code> - An alias of <a href="#path"><code>.path()</code></a>.</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> expectation = mockyeah
  .get(<span class="hljs-string">&apos;*&apos;</span>)
  .expect()
  .url(<span class="hljs-string">&apos;/foo&apos;</span>);
</code></pre>
<div id="body"></div>

<p><code>.body(MatchValue)</code> - Adds an expectation that a service must receive only requests with bodies matching the body specified. See <a href="Match-Values.html">match value</a>.</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> expectation = mockyeah
  .get(<span class="hljs-string">&apos;/say-hello&apos;</span>, { text: <span class="hljs-string">&apos;hello&apos;</span> })
  .expect()
  .body({
    foo: <span class="hljs-string">&apos;bar&apos;</span>
  });
</code></pre>
<div id="params"></div>

<p><code>.params(MatchValue)</code> - Adds expectation that a service must receive only requests with query params matching those specified. See <a href="Match-Values.html">match value</a>.</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> expectation = mockyeah
  .get(<span class="hljs-string">&apos;/say-hello&apos;</span>, { text: <span class="hljs-string">&apos;hello&apos;</span> })
  .expect()
  .params({
    id: <span class="hljs-string">&apos;9999&apos;</span>
  });
</code></pre>
<div id="query"></div>

<p><code>.query(MatchValue)</code> - An alias of <a href="#params"><code>.params(Object)</code></a>.</p>
<div id="header"></div>

<p><code>.header(key, MatchValue)</code> - Adds expectation that a service must receive only requests with headers matching those specified. See <a href="Match-Values.html">match value</a>.</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> expectation = mockyeah
  .get(<span class="hljs-string">&apos;/say-hello&apos;</span>, { text: <span class="hljs-string">&apos;hello&apos;</span> })
  .expect()
  .header(<span class="hljs-string">&apos;host&apos;</span>, <span class="hljs-string">&apos;example.com&apos;</span>);
</code></pre>
<h2 id="execute">Execute</h2>
<div id="run"></div>

<p><code>.run(functionOrPromise)</code> - This will register side effects to run
before <code>.verify()</code> logic is executed, e.g., after a network call.
Pass a function which will be called with an argument that is a Node-style callback function reference
to be executed by you when you&apos;re ready for <code>.verify()</code> to be called.
Or pass a promise, which mockyeah will wait for to be settled until calling <code>.verify()</code>.
Or pass a function that returns a promise, with the same effect.
This is a fluent shorthand so you don&apos;t have to assign to an intermediary variable, e.g., <code>expectation</code>
just to be able to call <code>verify()</code> later.</p>
<p>With promise:</p>
<pre><code class="lang-js">mockyeah
  .get(<span class="hljs-string">&apos;/foo&apos;</span>, { text: <span class="hljs-string">&apos;bar&apos;</span> })
  .expect()
  .params({
    id: <span class="hljs-string">&apos;9999&apos;</span>
  })
  .once()
  .run(request.get(<span class="hljs-string">&apos;/foo?id=9999&apos;</span>))
  .verify(done);
</code></pre>
<p>Or function returning promise:</p>
<pre><code class="lang-js">mockyeah
  .get(<span class="hljs-string">&apos;/foo&apos;</span>, { text: <span class="hljs-string">&apos;bar&apos;</span> })
  .expect()
  .params({
    id: <span class="hljs-string">&apos;9999&apos;</span>
  })
  .once()
  .run(() =&gt; request.get(<span class="hljs-string">&apos;/foo?id=9999&apos;</span>))
  .verify(done);
</code></pre>
<p>Or function calling callback:</p>
<pre><code class="lang-js">mockyeah
  .get(<span class="hljs-string">&apos;/foo&apos;</span>, { text: <span class="hljs-string">&apos;bar&apos;</span> })
  .expect()
  .params({
    id: <span class="hljs-string">&apos;9999&apos;</span>
  })
  .once()
  .run(cb =&gt; {
    request.get(<span class="hljs-string">&apos;/foo?id=9999&apos;</span>).end(cb);
  })
  .verify(done);
</code></pre>
<div id="verify"></div>

<p><code>.verify(callback)</code> - Asserts expectation to be correct, and if optional callback is provided, using that to pass up assertion errors instead of throwing an assert error inline.
If passed a promise, or a callback returning a promise, then it will return this promise, e.g., to return to a test framework like <code>jest</code> or <code>mocha</code> supporting that.</p>
<pre><code class="lang-js">expectation.verify();
</code></pre>
<p>The <code>body</code>, <code>params</code>, and <code>header</code> methods also accept a function instead of an object, for custom validations.
These functions receive as a first parameter the parsed body, query parameters object, or header value, respectively,
and should return <code>true</code> to indicate a pass, or return <code>false</code> or throw an error (like many assertion libraries) to indicate a failure.</p>
<p>If <code>run</code> was called, verification will pause until the function or promise passed to <code>run</code> completes.</p>
<p>Also, <code>verify</code> returns a promise, which can be returned directly to test frameworks without using any <code>done</code> callbacks.</p>
<div id="verifier"></div>

<p><code>.verifier(callback)</code> - Creates a callback function for you for use after any side effects under test
that bubbles any errors passed to it up to the provided callback (in the Node style),
and otherwise safely calls <code>.verify(callback)</code> internally in a <code>try</code>/<code>catch</code> and again forwarding any errors.
It&apos;s a shorthand so that you can write this:</p>
<pre><code class="lang-js">request(<span class="hljs-string">&apos;http://localhost:4040&apos;</span>)
  .get(<span class="hljs-string">&apos;/say-hello?foo=bar&apos;</span>)
  .expect(<span class="hljs-number">200</span>, expectation.verifier(done));
</code></pre>
<p>Instead of this:</p>
<pre><code class="lang-js">request(<span class="hljs-string">&apos;http://localhost:4040&apos;</span>)
  .get(<span class="hljs-string">&apos;/say-hello?foo=bar&apos;</span>)
  .expect(<span class="hljs-number">200</span>, err =&gt; {
    <span class="hljs-keyword">if</span> (err) {
      done(err);
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">try</span> {
      expectation.verify(done);
    } <span class="hljs-keyword">catch</span> (err2) {
      done(err2);
    }
  });
</code></pre>
<div id="examples"></div>

<h2 id="examples">Examples</h2>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> expectation = mockyeah
  .get(<span class="hljs-string">&apos;/foo&apos;</span>, { text: <span class="hljs-string">&apos;bar&apos;</span> })
  .expect()
  .header(<span class="hljs-string">&apos;X-API-Key&apos;</span>, value =&gt; <span class="hljs-regexp">/[0-9A-F]{32}/i</span>.test(value));
</code></pre>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { expect } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;chai&apos;</span>);

<span class="hljs-keyword">const</span> expectation = mockyeah
  .get(<span class="hljs-string">&apos;/foo&apos;</span>, { text: <span class="hljs-string">&apos;bar&apos;</span> })
  .expect()
  .params(params =&gt;
    expect(params).to.equal({
      some: <span class="hljs-string">&apos;value&apos;</span>
    })
  );
</code></pre>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> expectation = mockyeah
  .get(<span class="hljs-string">&apos;/foo&apos;</span>, { text: <span class="hljs-string">&apos;bar&apos;</span> })
  .expect()
  .params(params =&gt; params.someParam === <span class="hljs-string">&apos;yes&apos;</span>);
</code></pre>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> expectation = mockyeah
  .get(<span class="hljs-string">&apos;/foo&apos;</span>, { text: <span class="hljs-string">&apos;bar&apos;</span> })
  .expect()
  .body(body =&gt; body.id === <span class="hljs-string">&apos;123&apos;</span>);
</code></pre>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="Expectation-API.html#structural" class="navigation navigation-next navigation-unique" aria-label="Next page: Quantitative">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":".expect()","level":"1.4.2.1","depth":3,"next":{"title":"Quantitative","level":"1.4.2.2","depth":3,"anchor":"#structural","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#structural","articles":[]},"previous":{"title":"Expectation API","level":"1.4.2","depth":2,"ref":"","articles":[{"title":".expect()","level":"1.4.2.1","depth":3,"anchor":"#expect","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#expect","articles":[]},{"title":"Quantitative","level":"1.4.2.2","depth":3,"anchor":"#structural","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#structural","articles":[]},{"title":".expect().atLeast()","level":"1.4.2.3","depth":3,"anchor":"#atLeast","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#atLeast","articles":[]},{"title":".expect().atMost()","level":"1.4.2.4","depth":3,"anchor":"#atMost","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#atMost","articles":[]},{"title":".expect().never()","level":"1.4.2.5","depth":3,"anchor":"#never","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#never","articles":[]},{"title":".expect().once()","level":"1.4.2.6","depth":3,"anchor":"#once","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#once","articles":[]},{"title":".expect().twice()","level":"1.4.2.7","depth":3,"anchor":"#twice","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#twice","articles":[]},{"title":".expect().thrice()","level":"1.4.2.8","depth":3,"anchor":"#thrice","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#thrice","articles":[]},{"title":".expect().exactly()","level":"1.4.2.9","depth":3,"anchor":"#exactly","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#exactly","articles":[]},{"title":"Structural","level":"1.4.2.10","depth":3,"anchor":"#structural","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#structural","articles":[]},{"title":".expect().path()","level":"1.4.2.11","depth":3,"anchor":"#path","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#path","articles":[]},{"title":".expect().url()","level":"1.4.2.12","depth":3,"anchor":"#url","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#url","articles":[]},{"title":".expect().body()","level":"1.4.2.13","depth":3,"anchor":"#body","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#body","articles":[]},{"title":".expect().params()","level":"1.4.2.14","depth":3,"anchor":"#params","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#params","articles":[]},{"title":".expect().header()","level":"1.4.2.15","depth":3,"anchor":"#header","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#header","articles":[]},{"title":"Execute","level":"1.4.2.16","depth":3,"anchor":"#execute","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#execute","articles":[]},{"title":".expect().run()","level":"1.4.2.17","depth":3,"anchor":"#run","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#run","articles":[]},{"title":".expect().verify()","level":"1.4.2.18","depth":3,"anchor":"#verify","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#verify","articles":[]},{"title":".expect().verifier()","level":"1.4.2.19","depth":3,"anchor":"#verifier","path":"API/Expectation-API.md","ref":"API/Expectation-API.md#verifier","articles":[]}]},"dir":"ltr"},"config":{"plugins":["github","expandable-chapters"],"root":"book","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"github":{"url":"https://github.com/mockyeah/mockyeah"},"expandable-chapters":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Ryan Ricard","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"mockyeah","gitbook":"*","description":"A powerful service mocking, recording, and playback utility."},"file":{"path":"API/Expectation-API.md","mtime":"2019-05-06T07:14:04.713Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-05-06T09:08:51.511Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

